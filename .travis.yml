sudo: false
language: java
jdk:
  - oraclejdk8

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/

install: gradle assemble -Dbuild.snapshot=false

script: gradle core:test -Dbuild.snapshot=false

before_deploy:
  - export TARBALL=$(ls distribution/tar/build/distributions/elassandra-*.tar.gz)
  - export ZIPBALL=$(ls distribution/zip/build/distributions/elassandra-*.zip)
  - export DEBPKG=$(ls distribution/deb/build/distributions/elassandra-*.deb)
  - export RPMPKG=$(ls distribution/rpm/build/distributions/elassandra-*.rpm)

deploy:
  - provider: releases
    overwrite: true
    draft: false
    api_key:
      secure: "s1xzBLDe3zZCCldpbC1a83V70qOTaNJI9FIInkBA+oE7bj1Hf1RmZ0Gf4USboEvcJfhpYUAzv0N14VCzeKg+4fHXefTVJdLWuJW3DIudn+61XDoKBtEBbWyVwY8C5lqfdiDCekZhhabI4q7Oby3ymK6PtOL1EJ4UXjzjnj5YR/ZdME3OLgFlQec0Dm3bh8TwZsKfv6ep2tjp6e7QlWwQ6TqPp0zPZkn/CwnW0c6rkAFBCViRy7mKmkbsaLTlA2tAJ0BmikavSw8tgMtqwwGCoF1Tq4mz5GE1g2EP3kPm6vvBRb3IVTpaa7jom+W+oZ2toOY6X5TidF0Ga9NlktUNhFwUHeeDKVh6KBpTNaYtFbeUA8mypvRjZrdbsP3Oywgr8gcf7l0117o7bCg/umKSB184kIPktDi5zoSFdWyOB2CfmUXdl1LBZt7oFD9MdtgJo8cCFefRSno1PIfWdBov0xPTQZiO25naZC5Fea5mXYcw9kerWbO47drW4dRuVWb/XtEZwso1GbrKSYg83bBiZERpSWNasY3PN6Hxpm5RriSlPEsyJQkGubtztdnWT4+KFXZWgwGyR9XEY4j0cgdDiHaireeJHJNhGXkjiT6RJqVTE9e7wW7VvX7Sri02jfJE+eUuBTbbLJ/AXnclSfyrwYZIYb3bYEHcoRZoX8I+MWg="
    file:
      - "$TARBALL"
      - "$ZIPBALL"
      - "$RPMPKG"
      - "$DEBPKG"
    skip_cleanup: true
    on:
      tags: true
      repo: strapdata/elassandra

  - provider: releases
    overwrite: true
    draft: false
    api_key:
      secure: "CtTEWfptldC5QoeOl+nseF3uVyjmJglxnk7Mv9qHH4w24/R3GI6Q4TsJxLjp0yf0+ltnE6vg1wERIY5HiE0jvIM3l/ZFUKEFE/f6h9yvmUWFaQD2yOKNKB4fvqYfX0KZWDF0YotMi3bweegrXS66fu5s3jfjXH6DLNmzGjv0cAcumdppJDUOmETktIlWr86KKRJMuYTXiJIe4CXLfgkZEEY7cYsHysrfJvYBPYka9n4kzlcj0PB3Ux4mT8flMLIzfFymnxGWXv2Ubf1DJpCtfyb65OqFqMcWL1NjL+T2Z3OoWI5QgMtoapHX6Z6xuoBQbnN+PR5dq7pmUXJKXpoEsBzfMdv8FpiPS/NV1iRIEzgpab7nIuQ00QDkTA6R+69ugGpwOnaceoNIMnjOQjfaAHT6Xfc4vByFhhZxSp1H6hmdhtaksE1U1w4HMfHnejXTLCNMnsnbmDW1Tygjyu/zI7t9lCeF5kpnbXDV+oBHKxGR6yBZjVbG49Y3IQY7WFoFUKBgkCgYWqFMnLzCwVaJfqTFjQHOzhp1vg+RTgAtTWhjeWKwm9HqSH+R6F6tbhwKdPCDOOdzEAksnwmqUqi4iz8vjTsoiU86WXgds3PDVk4IK6ZxGRJ/UabQz/krXgay1dWOBVRYr4FzP+a5VH7mEyjdW+3SBMztbTw48g65jEE="
    file:
      - "$TARBALL"
      - "$ZIPBALL"
      - "$RPMPKG"
      - "$DEBPKG"
    skip_cleanup: true
    on:
      tags: true
      repo: strapdata/elassandra5-rc
